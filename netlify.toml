# ==============================================================================
# Green Health Netlify 设定档 (分支隔離版)
# ==============================================================================
# 此版本旨在確保 test-shiporder 分支的設定與其他分支完全隔離，
# 避免互相干擾。

# [build] 區塊定義了全局的建置設定。
# 我們在這裡不設定 publish，讓每個 context 自己決定。
[build]
  command = "echo '无需建置指令'"
  functions = "netlify/functions"

# ==============================================================================
# 🔁 重定向与重寫规则 (針對 test-shiporder 分支)
# ==============================================================================
# 使用 conditions = { "branch" = ["test-shiporder"] } 來確保
# 以下規則只在這個特定分支生效。

# 規則 1: 處理倉庫後台 (/warehouse-panel/) 的請求
[[redirects]]
  from = "/warehouse-panel/*"
  to = "/warehouse-panel/:splat"
  status = 200
  conditions = { branch = ["test-shiporder"] }

# 規則 2: 處理消費者前端 (GreenHealth-Auth-Module) 的請求
[[redirects]]
  from = "/*"
  to = "/GreenHealth-Auth-Module/:splat"
  status = 200
  conditions = { branch = ["test-shiporder"] }

# ==============================================================================
# ⚙️ 本地开发环境设定
# ==============================================================================
[dev]
  framework = "#static"
  publish = "."
  
# ==============================================================================
# 🔑 环境变数设定
# ==============================================================================
[context.production.environment]
  SUPABASE_URL = "https://your-project.supabase.co"
  SUPABASE_ANON_KEY = "your-anon-key"

# ==============================================================================
# 【核心设定】- 分支特定部署规则
# ==============================================================================

# 🟢 test-shiporder 分支设定
[context."test-shiporder"]
  # 在此分支，我們將整個專案的根目錄作為發布內容，
  # 這樣上面的 redirects 規則才能找到所有子資料夾。
  publish = "."

# 🟡 GreenHealth-Auth-Module 分支设定 (保留您原有的設定)
[context."GreenHealth-Auth-Module"]
  publish = "GreenHealth-Auth-Module"

# 🔴 main 分支设定 (假設 main 分支只部署消費者前端)
[context.main]
  publish = "GreenHealth-Auth-Module"