# ==============================================================================
# Green Health Netlify 设定档 (真正完整的最終版)
# ==============================================================================
#
# 此設定檔整合了多應用程式部署的路由規則，並保留了原有的本地開發
# 與生產環境變數設定。
#
# ==============================================================================

# [build] 區塊定義了全局的建置設定。
[build]
  # command: 執行建置時的指令。
  command = "echo '无需建置指令'"

  # publish: 指定部署的根目錄。設定為 "." 代表部署整個專案根目錄，
  #          這是讓後續重寫規則能正確運作的前提。
  publish = "."
  
  # functions: 如果您使用 Netlify Functions，請指向其目錄。
  #            由於我們是使用 Supabase CLI 部署 Edge Functions，此行可保留或移除。
  functions = "netlify/functions"

# ==============================================================================
# [[redirects]] 區塊定義了重定向與重寫規則。
# Netlify 會從上到下逐一匹配這些規則。
# ==============================================================================

# 規則 1: 處理倉庫後台 (/warehouse-panel/) 的請求
# 將所有 /warehouse-panel/ 開頭的請求，重寫到實際的 warehouse-panel 資料夾內。
[[redirects]]
  from = "/warehouse-panel/*"
  to = "/warehouse-panel/:splat"
  status = 200 # 200 表示這是一個內部重寫 (Rewrite)

# 規則 2: 處理消費者前端 (GreenHealth-Auth-Module) 的請求
# 將所有「其他」請求，重寫到 GreenHealth-Auth-Module 資料夾內。
[[redirects]]
  from = "/*"
  to = "/GreenHealth-Auth-Module/:splat"
  status = 200

# 規則 3: 封鎖對 config.js 的直接訪問 (保留您原有的安全規則)
[[redirects]]
  from = "/config.js"
  to = "/404.html"
  status = 404

# ==============================================================================
# ⚙️ 本地开发环境设定 (保留您原有的設定)
# ==============================================================================
[dev]
  framework = "#static"
  publish = "."
  
# ==============================================================================
# 🔑 环境变数设定 (保留您原有的設定)
# ==============================================================================
# 這些變數主要用於 Netlify 的建置過程，或者可以透過 Netlify UI 設定。
# 注意：敏感金鑰 (如 SERVICE_ROLE_KEY) 建議只存在於 Netlify UI 的環境變數設定中，
# 而不是寫在 toml 檔案裡。
[context.production.environment]
  SUPABASE_URL = "https://your-project.supabase.co"
  SUPABASE_ANON_KEY = "your-anon-key"